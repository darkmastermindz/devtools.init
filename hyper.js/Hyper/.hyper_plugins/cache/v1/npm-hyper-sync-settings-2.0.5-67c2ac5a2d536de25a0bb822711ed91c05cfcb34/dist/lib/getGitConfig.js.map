{"version":3,"sources":["../../src/lib/getGitConfig.js"],"names":["config","process","env","HYPER_SYNC_SETTINGS_PERSONAL_ACCESS_TOKEN","HYPER_SYNC_SETTINGS_GIST_ID","require","paths","files","err","console","error","fs","copySync","configTemplate","personalAccessToken","gistId","remoteUrl","repoPromise","ensureDirAsync","dirs","repo","clone","resolve","errorTitle","url"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AAEA,IAAIA,SAAS,EAAb;;mBAKIC,QAAQC,G;MAFVC,yC,gBAAAA,yC;MACAC,2B,gBAAAA,2B;;;AAGF,IACE,CAACD,yCAAD,IACA,CAACC,2BAFH,EAGE;AACA,MAAI;AACFJ,aAASK,QAAQC,iBAAMC,KAAN,CAAYP,MAApB,CAAT,CADE,CACoC;AACvC,GAFD,CAEE,OAAOQ,GAAP,EAAY;AACZC,YAAQC,KAAR,EAAe;AACZ,+DACCJ,iBAAMC,KAAN,CAAYP,MACb,kBAHH;AAKAW,iBAAGC,QAAH,CAAYN,iBAAMC,KAAN,CAAYM,cAAxB,EAAwCP,iBAAMC,KAAN,CAAYP,MAApD;AACD;AACF;;AAED,IAAIG,yCAAJ,EAA+C;AAC7CH,SAAOc,mBAAP,GAA6BX,yCAA7B;AACD;;AAED,IAAIC,2BAAJ,EAAiC;AAC/BJ,SAAOe,MAAP,GAAgBX,2BAAhB;AACD;;kBAEc,MAAM;AAAA,gBACqBJ,MADrB;AAAA,QACXc,mBADW,WACXA,mBADW;AAAA,QACUC,MADV,WACUA,MADV;;;AAGnB,MAAI,CAACD,mBAAD,IAAwB,CAACC,MAA7B,EAAqC,OAAOf,MAAP;;AAErC,QAAMgB,YAAY,wBAAQD,MAAR,EAAgBD,mBAAhB,CAAlB;;AAEA,QAAMG,cAAc,gCAClB,aAAY;AACV,UAAMN,aAAGO,cAAH,CAAkBZ,iBAAMa,IAAN,CAAWC,IAA7B,CAAN;AACA,WAAO,sBACL,mBAAW;AACT,+BAAUd,iBAAMa,IAAN,CAAWC,IAArB,EAA2BC,KAA3B,CACEL,SADF,EAEEV,iBAAMa,IAAN,CAAWC,IAFb,EAGE,UAACV,KAAD,EAAW;AACTY;AACA,YAAIZ,KAAJ,EAAWD,QAAQC,KAAR,CAAe,GAAEa,qBAAW,IAAGb,KAAM,EAArC,EAFF,CAE2C;AACrD,OANH;AAQD,KAVI,CAAP;AAYD,GAfiB,GAApB;;AAkBA,oCACKV,MADL;AAEEwB,SAAK,wBAAQT,MAAR,CAFP;AAGEC,aAHF;AAIEC;AAJF;AAMD,C","file":"getGitConfig.js","sourcesContent":["import simpleGit from 'simple-git';\nimport fs from './fs';\nimport { paths, gistUrl, errorTitle } from '../constants';\n\nlet config = {};\n\nconst {\n  HYPER_SYNC_SETTINGS_PERSONAL_ACCESS_TOKEN,\n  HYPER_SYNC_SETTINGS_GIST_ID,\n} = process.env;\n\nif (\n  !HYPER_SYNC_SETTINGS_PERSONAL_ACCESS_TOKEN ||\n  !HYPER_SYNC_SETTINGS_GIST_ID\n) {\n  try {\n    config = require(paths.files.config); // eslint-disable-line import/no-dynamic-require, global-require, max-len\n  } catch (err) {\n    console.error( // eslint-disable-line no-console\n      `hyper-sync-settings: error ðŸ”¥ no config file found in \\`${\n        paths.files.config\n      }\\`, creating one`,\n    );\n    fs.copySync(paths.files.configTemplate, paths.files.config);\n  }\n}\n\nif (HYPER_SYNC_SETTINGS_PERSONAL_ACCESS_TOKEN) {\n  config.personalAccessToken = HYPER_SYNC_SETTINGS_PERSONAL_ACCESS_TOKEN;\n}\n\nif (HYPER_SYNC_SETTINGS_GIST_ID) {\n  config.gistId = HYPER_SYNC_SETTINGS_GIST_ID;\n}\n\nexport default () => {\n  const { personalAccessToken, gistId } = config;\n\n  if (!personalAccessToken || !gistId) return config;\n\n  const remoteUrl = gistUrl(gistId, personalAccessToken);\n\n  const repoPromise = (\n    async () => {\n      await fs.ensureDirAsync(paths.dirs.repo);\n      return new Promise(\n        resolve => {\n          simpleGit(paths.dirs.repo).clone(\n            remoteUrl,\n            paths.dirs.repo,\n            (error) => {\n              resolve();\n              if (error) console.error(`${errorTitle} ${error}`); // eslint-disable-line no-console\n            },\n          );\n        },\n      );\n    }\n  )();\n\n  return {\n    ...config,\n    url: gistUrl(gistId),\n    remoteUrl,\n    repoPromise,\n  };\n};\n"]}