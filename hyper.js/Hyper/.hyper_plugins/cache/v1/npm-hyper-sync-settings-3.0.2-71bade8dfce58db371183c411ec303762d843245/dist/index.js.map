{"version":3,"file":"index.js","sources":["../src/constants.ts","../src/lib/notify.ts","../src/lib/getGitConfig.ts","../src/lib/getCommands/updates.ts","../src/lib/getCommands/restore.ts","../src/lib/getCommands/backup.ts","../src/lib/getCommands/index.ts","../src/lib/checkForMissingSettings.ts","../src/decorateMenu.ts"],"sourcesContent":["import { app, App } from 'electron';\nimport { homedir } from 'os';\nimport { resolve as resolvePath } from 'path';\n\nexport interface SyncSettings {\n  quiet?: boolean;\n  accelerators?: Record<Accelerators, string>;\n}\n\nexport type HyperApp = App & {\n  config: { getConfig: () => { syncSettings?: SyncSettings } };\n};\n\nexport const hyperApp = app as HyperApp;\n\nexport const GIST_URL = (gistId: string, token?: string): string =>\n  `https://${token ? `${token}@` : ''}gist.github.com/${gistId}.git`;\n\nexport const TITLE = 'hyper-sync-settings';\nexport const ERROR_TITLE = `${TITLE} error üî•`;\nexport const SETUP_URL =\n  'https://github.com/dfrankland/hyper-sync-settings#setup';\n\n// If the user defines XDG_CONFIG_HOME they definitely want their config there,\n// otherwise use the home directory in linux/mac and userdata in windows\nexport const DIR_HOME = (): string => {\n  if (typeof process.env.XDG_CONFIG_HOME !== 'undefined') {\n    return resolvePath(process.env.XDG_CONFIG_HOME, 'hyper');\n  }\n\n  return process.platform === 'win32' ? app.getPath('userData') : homedir();\n};\n\nexport const DIR_REPO = (): string =>\n  resolvePath(DIR_HOME(), '.hyper_plugins', '.hyper-sync-settings');\n\nexport const FILE_CONFIG = (): string =>\n  resolvePath(DIR_HOME(), '.hyper_plugins', '.hyper-sync-settings.json');\n\nexport const FILE_CONFIG_TEMPLATE = resolvePath(\n  __dirname,\n  'config.default.json',\n);\nexport const FILE_BACKUP = (): string => resolvePath(DIR_REPO(), '.hyper.js');\n\nexport const FILE_RESTORE = (): string => resolvePath(DIR_HOME(), '.hyper.js');\n\nexport type Accelerators =\n  | 'checkForUpdates'\n  | 'backupSettings'\n  | 'restoreSettings'\n  | 'openGist'\n  | 'openRepo'\n  | 'openConfiguration';\n\nexport const POSSIBLE_ACCELERATORS: [\n  'checkForUpdates',\n  'backupSettings',\n  'restoreSettings',\n  'openGist',\n  'openRepo',\n  // eslint-disable-next-line prettier/prettier\n  'openConfiguration'\n] = [\n  'checkForUpdates',\n  'backupSettings',\n  'restoreSettings',\n  'openGist',\n  'openRepo',\n  'openConfiguration',\n];\n","import { app, Notification, shell } from 'electron';\n\nexport interface NotifyOptions {\n  title: string;\n  body?: string;\n  url?: string;\n  level?: 'debug' | 'info' | 'warn' | 'error';\n}\n\nexport default ({ title, body, url, level = 'debug' }: NotifyOptions): void => {\n  // eslint-disable-next-line no-console\n  console[level]([title, body, url].filter(Boolean).join('\\n'));\n\n  if (!app || !app.isReady()) return;\n\n  const notification = new Notification({\n    title,\n    body: body || '',\n  });\n\n  if (url) {\n    notification.on('click', (): void => {\n      shell.openExternal(url);\n    });\n  }\n\n  notification.show();\n};\n","import { GitProcess } from 'dugite';\nimport { copyFile, ensureDir, readJson, pathExists } from 'fs-extra';\nimport {\n  FILE_CONFIG,\n  FILE_CONFIG_TEMPLATE,\n  GIST_URL,\n  ERROR_TITLE,\n  DIR_REPO,\n} from '../constants';\nimport notify from './notify';\n\nexport interface IdAndToken {\n  personalAccessToken: string;\n  gistId: string;\n}\n\nexport interface GitConfig extends IdAndToken {\n  url: string;\n  remoteUrl: string;\n  repoPromise: Promise<void>;\n}\n\nconst getIdAndToken = async (): Promise<IdAndToken> => {\n  let config: IdAndToken = {\n    personalAccessToken: '',\n    gistId: '',\n  };\n\n  const {\n    HYPER_SYNC_SETTINGS_PERSONAL_ACCESS_TOKEN,\n    HYPER_SYNC_SETTINGS_GIST_ID,\n  } = process.env;\n\n  if (\n    !HYPER_SYNC_SETTINGS_PERSONAL_ACCESS_TOKEN ||\n    !HYPER_SYNC_SETTINGS_GIST_ID\n  ) {\n    try {\n      if (!(await pathExists(FILE_CONFIG()))) {\n        notify({\n          title: ERROR_TITLE,\n          body: `no config file found in \\`${FILE_CONFIG()}\\`, creating one`,\n          level: 'error',\n        });\n        await copyFile(FILE_CONFIG_TEMPLATE, FILE_CONFIG());\n      } else {\n        try {\n          config = await readJson(FILE_CONFIG());\n        } catch (err) {\n          notify({\n            title: ERROR_TITLE,\n            body: `could not read \\`${FILE_CONFIG()}\\`, maybe the JSON is not valid?`,\n            level: 'error',\n          });\n        }\n      }\n    } catch (err) {\n      notify({\n        title: ERROR_TITLE,\n        body: `could not check in \\`${FILE_CONFIG()}\\` for config file`,\n        level: 'error',\n      });\n    }\n  }\n\n  if (HYPER_SYNC_SETTINGS_PERSONAL_ACCESS_TOKEN) {\n    config.personalAccessToken = HYPER_SYNC_SETTINGS_PERSONAL_ACCESS_TOKEN;\n  }\n\n  if (HYPER_SYNC_SETTINGS_GIST_ID) {\n    config.gistId = HYPER_SYNC_SETTINGS_GIST_ID;\n  }\n\n  return config;\n};\n\nexport default async (): Promise<GitConfig> => {\n  const config: GitConfig = {\n    ...(await getIdAndToken()),\n    url: '',\n    remoteUrl: '',\n    repoPromise: Promise.resolve(),\n  };\n\n  const { personalAccessToken, gistId } = config;\n\n  if (!personalAccessToken || !gistId) return config;\n\n  const remoteUrl = GIST_URL(gistId, personalAccessToken);\n\n  const repoPromise = (async (): Promise<void> => {\n    await ensureDir(DIR_REPO());\n    try {\n      await GitProcess.exec(['clone', remoteUrl, '.'], DIR_REPO());\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.error(`${ERROR_TITLE} ${err.message}`);\n    }\n  })();\n\n  return {\n    ...config,\n    url: GIST_URL(gistId),\n    remoteUrl,\n    repoPromise,\n  };\n};\n","import { GitProcess } from 'dugite';\nimport moment, { Moment } from 'moment';\nimport { DIR_REPO } from '../../constants';\nimport { GitConfig } from '../getGitConfig';\n\nconst getLastCommit = async (): Promise<{ hash: string; date: Moment }> => {\n  const { stdout } = await GitProcess.exec(\n    [\n      'log',\n      '-n',\n      '1',\n      '--date=iso',\n      '--pretty=format:{ \"hash\": \"%H\", \"date\": \"%ad\" }',\n    ],\n    DIR_REPO(),\n  );\n\n  const { hash, date } = JSON.parse(stdout);\n\n  return { hash, date: moment(date, 'YYYY-MM-DD HH:mm:ss Z') };\n};\n\nexport default async ({ repoPromise }: GitConfig): Promise<boolean> => {\n  await repoPromise;\n  await GitProcess.exec(['fetch'], DIR_REPO());\n  await GitProcess.exec(['checkout', 'origin/master'], DIR_REPO());\n  const remote = await getLastCommit();\n  await GitProcess.exec(['checkout', 'master'], DIR_REPO());\n  const local = await getLastCommit();\n  return moment(remote.date).isAfter(local.date) && local.hash !== remote.hash;\n};\n","import { GitProcess } from 'dugite';\nimport { ensureFile, copyFile } from 'fs-extra';\nimport { FILE_RESTORE, FILE_BACKUP, DIR_REPO } from '../../constants';\nimport { GitConfig } from '../getGitConfig';\n\nexport default async ({ repoPromise }: GitConfig): Promise<void> => {\n  await repoPromise;\n  await GitProcess.exec(['fetch'], DIR_REPO());\n  await GitProcess.exec(['merge', 'origin/master', 'master'], DIR_REPO());\n  await ensureFile(FILE_RESTORE());\n  await copyFile(FILE_BACKUP(), FILE_RESTORE());\n};\n","import { GitProcess } from 'dugite';\nimport { copy } from 'fs-extra';\nimport { FILE_RESTORE, FILE_BACKUP, DIR_REPO } from '../../constants';\nimport { GitConfig } from '../getGitConfig';\n\nexport default async ({ repoPromise, remoteUrl }: GitConfig): Promise<void> => {\n  await copy(FILE_RESTORE(), FILE_BACKUP(), { overwrite: true });\n  await repoPromise;\n  await GitProcess.exec(['add', 'remote', remoteUrl], DIR_REPO());\n  await GitProcess.exec(['fetch'], DIR_REPO());\n  await GitProcess.exec(['add', '.'], DIR_REPO());\n  await GitProcess.exec(['commit', '-m', `${new Date()}`], DIR_REPO());\n  await GitProcess.exec(['push', 'origin', 'master'], DIR_REPO());\n};\n","import { TITLE, ERROR_TITLE, SyncSettings } from '../../constants';\nimport updates from './updates';\nimport restore from './restore';\nimport backup from './backup';\nimport { GitConfig } from '../getGitConfig';\nimport notify from '../notify';\n\nexport interface Commands {\n  checkForUpdates: () => Promise<void>;\n  tryToBackup: () => Promise<void>;\n  tryToRestore: () => Promise<void>;\n}\n\nexport default (config: GitConfig, { quiet }: SyncSettings): Commands => {\n  const catchError = (err: Error): void => {\n    notify({ title: ERROR_TITLE, body: err.message, level: 'error' });\n    throw err;\n  };\n\n  const notifyMsg = (emoji: string, message: string): void | string =>\n    notify({\n      title: `${TITLE} ${emoji}`,\n      body: message,\n      url: config.url,\n      level: 'info',\n    });\n\n  return {\n    checkForUpdates: async (): Promise<void> => {\n      const isUpdated = await updates(config).catch(catchError);\n\n      if (isUpdated) {\n        notifyMsg('‚ùóÔ∏è', 'Your settings need to be updated.');\n      } else if (!quiet) {\n        notifyMsg('üëç', 'Your settings are up to date.');\n      }\n    },\n    tryToBackup: async (): Promise<void> => {\n      await backup(config).catch(catchError);\n      notifyMsg('üîú', 'Your settings have been saved.');\n    },\n    tryToRestore: async (): Promise<void> => {\n      await restore(config).catch(catchError);\n      notifyMsg('üîô', 'Your settings have been restored.');\n    },\n  };\n};\n","import { app, App } from 'electron';\nimport { ERROR_TITLE, SETUP_URL, SyncSettings } from '../constants';\nimport getGitConfig, { GitConfig } from './getGitConfig';\nimport getCommands, { Commands } from './getCommands';\nimport notify from './notify';\n\nexport interface ConfigAndCommands {\n  config: GitConfig;\n  commands: Commands;\n}\n\nconst hyperApp: App & {\n  config?: { getConfig?: () => { syncSettings?: SyncSettings } };\n} = app;\n\nexport default async (): Promise<null | ConfigAndCommands> => {\n  const notifyErr = (message: string): void | string =>\n    notify({\n      title: ERROR_TITLE,\n      body: message,\n      url: SETUP_URL,\n      level: 'error',\n    });\n\n  if (!hyperApp.config || typeof hyperApp.config.getConfig !== 'function') {\n    throw new Error(\n      '`app` from `electron` does not have the `config` object from Hyper!',\n    );\n  }\n\n  const config = await getGitConfig();\n  const { personalAccessToken, gistId } = config;\n  const hyperConfig = hyperApp.config.getConfig().syncSettings || {\n    quiet: false,\n  };\n\n  if (personalAccessToken && gistId) {\n    const commands = getCommands(config, hyperConfig);\n    return { config, commands };\n  }\n\n  if (!personalAccessToken && !gistId) {\n    notifyErr('Settings not found! Click for more info.');\n    return null;\n  }\n\n  if (!personalAccessToken) {\n    notifyErr('`personalAccessToken` not set! Click for more info.');\n  }\n\n  if (!gistId) {\n    notifyErr('`gistId` not set! Click for more info.');\n  }\n\n  return null;\n};\n","import { MenuItemConstructorOptions, shell } from 'electron';\nimport { ensureDir } from 'fs-extra';\nimport checkForMissingSettings, {\n  ConfigAndCommands,\n} from './lib/checkForMissingSettings';\nimport {\n  GIST_URL,\n  DIR_REPO,\n  FILE_CONFIG,\n  POSSIBLE_ACCELERATORS,\n  Accelerators,\n  SyncSettings,\n  hyperApp,\n} from './constants';\n\ntype ValueOf<T> = T[keyof T];\n\nconst defaultAccelerators: Partial<SyncSettings['accelerators']> = {};\n\nexport default (\n  menu: MenuItemConstructorOptions[] = [],\n): MenuItemConstructorOptions[] => {\n  // Proactively notify about missing settings\n  (async (): Promise<void> => {\n    await hyperApp.whenReady();\n    checkForMissingSettings();\n  })();\n\n  const checkAndCallback = (\n    callback: (gitConfig: ConfigAndCommands) => void,\n  ): NonNullable<MenuItemConstructorOptions['click']> => async (): Promise<\n    void\n  > => {\n    const commandsAndConfig = await checkForMissingSettings();\n    if (commandsAndConfig === null) return;\n    callback(commandsAndConfig);\n  };\n\n  checkAndCallback(({ commands }: ConfigAndCommands): void => {\n    commands.checkForUpdates();\n  });\n\n  const {\n    syncSettings: {\n      accelerators: syncSettingsAccelerators = defaultAccelerators,\n    } = {},\n  } = hyperApp.config.getConfig();\n\n  const accelerators: Partial<\n    Record<Accelerators, { accelerator: ValueOf<SyncSettings['accelerators']> }>\n  > = POSSIBLE_ACCELERATORS.reduce(\n    (\n      allAccelerators: Partial<\n        Record<\n          Accelerators,\n          { accelerator: ValueOf<SyncSettings['accelerators']> }\n        >\n      >,\n      nextKey: Accelerators,\n    ): Partial<\n      Record<\n        Accelerators,\n        { accelerator: ValueOf<SyncSettings['accelerators']> }\n      >\n    > => {\n      const accelerator = syncSettingsAccelerators[nextKey];\n      return {\n        ...allAccelerators,\n        [nextKey]: accelerator ? { accelerator } : {},\n      };\n    },\n    {},\n  );\n\n  const newMenu = menu.map(\n    (item: MenuItemConstructorOptions): MenuItemConstructorOptions => {\n      if (item.label !== 'Plugins') return item;\n      return {\n        ...item,\n        submenu: [\n          ...(Array.isArray(item.submenu) ? item.submenu : []),\n          {\n            label: 'Sync Settings',\n            type: 'submenu',\n            submenu: [\n              {\n                label: 'Check for Updates',\n                click: checkAndCallback(\n                  ({ commands }: ConfigAndCommands): void => {\n                    commands.checkForUpdates();\n                  },\n                ),\n                ...accelerators.checkForUpdates,\n              },\n              {\n                label: 'Backup Settings',\n                click: checkAndCallback(\n                  ({ commands }: ConfigAndCommands): void => {\n                    commands.tryToBackup();\n                  },\n                ),\n                ...accelerators.backupSettings,\n              },\n              {\n                label: 'Restore Settings',\n                click: checkAndCallback(\n                  ({ commands }: ConfigAndCommands): void => {\n                    commands.tryToRestore();\n                  },\n                ),\n                ...accelerators.restoreSettings,\n              },\n              {\n                label: 'Open',\n                type: 'submenu',\n                submenu: [\n                  {\n                    label: 'Gist',\n                    click: (...args): void => {\n                      checkAndCallback(\n                        ({ config }: ConfigAndCommands): void => {\n                          if (config.url) {\n                            shell.openExternal(config.url);\n                            return;\n                          }\n\n                          if (config.gistId) {\n                            shell.openExternal(GIST_URL(config.gistId));\n                            return;\n                          }\n\n                          shell.openExternal('https://gist.github.com');\n                        },\n                      )(...args);\n                    },\n                    ...accelerators.openGist,\n                  },\n                  {\n                    label: 'Repo',\n                    click: async (): Promise<void> => {\n                      await ensureDir(DIR_REPO());\n                      shell.openItem(DIR_REPO());\n                    },\n                    ...accelerators.openRepo,\n                  },\n                  {\n                    label: 'Configuration',\n                    click: (): void => {\n                      shell.openItem(FILE_CONFIG());\n                    },\n                    ...accelerators.openConfiguration,\n                  },\n                ],\n              },\n            ],\n          },\n        ],\n      };\n    },\n  );\n\n  return newMenu;\n};\n"],"names":["hyperApp","app","GIST_URL","gistId","token","TITLE","ERROR_TITLE","SETUP_URL","DIR_HOME","process","env","XDG_CONFIG_HOME","resolvePath","platform","getPath","homedir","DIR_REPO","FILE_CONFIG","FILE_CONFIG_TEMPLATE","__dirname","FILE_BACKUP","FILE_RESTORE","POSSIBLE_ACCELERATORS","title","body","url","level","console","filter","Boolean","join","isReady","notification","Notification","on","shell","openExternal","show","getIdAndToken","config","personalAccessToken","HYPER_SYNC_SETTINGS_PERSONAL_ACCESS_TOKEN","HYPER_SYNC_SETTINGS_GIST_ID","pathExists","notify","copyFile","readJson","err","remoteUrl","repoPromise","Promise","resolve","ensureDir","GitProcess","exec","error","message","getLastCommit","stdout","hash","date","JSON","parse","moment","remote","local","isAfter","ensureFile","copy","overwrite","Date","quiet","catchError","notifyMsg","emoji","checkForUpdates","isUpdated","updates","catch","tryToBackup","backup","tryToRestore","restore","notifyErr","getConfig","Error","getGitConfig","hyperConfig","syncSettings","commands","getCommands","defaultAccelerators","menu","whenReady","checkForMissingSettings","checkAndCallback","callback","commandsAndConfig","accelerators","syncSettingsAccelerators","reduce","allAccelerators","nextKey","accelerator","newMenu","map","item","label","submenu","Array","isArray","type","click","backupSettings","restoreSettings","args","openGist","openItem","openRepo","openConfiguration"],"mappings":"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"}